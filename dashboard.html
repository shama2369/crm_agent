<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trichy Gold Feedback Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #805AD5;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .mode-selector {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .radio-group {
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 15px 25px;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .radio-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .radio-item input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #805AD5;
        }

        .radio-item label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #805AD5;
            cursor: pointer;
        }

        .radio-item input[type="radio"]:checked + label {
            color: #4C1D95;
        }

        .radio-item:has(input[type="radio"]:checked) {
            background: #805AD5;
            color: white;
        }

        .radio-item:has(input[type="radio"]:checked) label {
            color: white;
        }

        .content-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }

        /* Show first content section (recorder) by default, hide others */
        .content-section:first-of-type {
            display: block;
        }
        
        .content-section:not(:first-of-type) {
            display: none;
        }

        /* Recorder Styles */
        .recorder-section {
            display: block;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        #recordBtn {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }

        #recordBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        #stopBtn {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
        }

        #stopBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }

        #completeBtn {
            background: linear-gradient(135deg, #805AD5, #4C1D95);
            color: white;
        }

        #completeBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(128, 90, 213, 0.3);
        }

        .image-upload-section {
            margin: 20px 0;
            text-align: center;
        }

        .image-label {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(135deg, #F59E0B, #D97706);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .image-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
        }

        .image-preview {
            margin-top: 15px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            margin-top: 20px;
        }

        .status.recording {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            color: #92400E;
        }

        .status.processing {
            background: linear-gradient(135deg, #DBEAFE, #BFDBFE);
            color: #1E40AF;
        }

        .status.success {
            background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
            color: #065F46;
        }

        .status.error {
            background: linear-gradient(135deg, #FEE2E2, #FECACA);
            color: #991B1B;
        }

        .recording-guidance {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            border-radius: 12px;
            border: 1px solid #e0e7ff;
        }

        .recording-guidance h3 {
            color: #805AD5;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        .guidance-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .guidance-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .guidance-section h4 {
            color: #805AD5;
            margin-bottom: 10px;
            font-size: 1rem;
            border-bottom: 2px solid #e0e7ff;
            padding-bottom: 5px;
        }

        .guidance-section ul {
            margin: 0;
            padding-left: 20px;
        }

        .guidance-section li {
            margin-bottom: 8px;
            color: #555;
            line-height: 1.4;
        }

        .guidance-section strong {
            color: #805AD5;
            font-weight: 600;
        }

        /* Filter Table Styles */
        .filter-section {
            display: block;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            color: #805AD5;
            margin-bottom: 5px;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #805AD5;
        }

        .filter-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .filter-btn {
            background: linear-gradient(135deg, #805AD5, #4C1D95);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(128, 90, 213, 0.3);
        }

        .table-info {
            margin-bottom: 15px;
            font-weight: 600;
            color: #805AD5;
            font-size: 1.1rem;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 1200px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }

        td {
            font-size: 14px;
            font-family: "Inter", "Segoe UI", Arial, sans-serif;
            color: #374151;
        }

        th {
            background: #F8FAFC;
            color: #374151;
            font-weight: bold;
            font-size: 14px;
            font-family: "Inter", "Segoe UI", Arial, sans-serif;
            position: sticky;
            top: 0;
            padding: 12px 8px;
            text-align: left;
            border-bottom: 2px solid #E5E7EB;
            border-right: 1px solid #E5E7EB;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .filter-row th {
            background: #F8FAFC;
            color: #374151;
            padding: 1px;
            border-bottom: 1px solid #E5E7EB;
            border-right: 1px solid #E5E7EB;
            height: 20px;
            font-size: 10px;
        }

        .header-filter {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #D1D5DB;
            border-radius: 3px;
            font-size: 14px;
            font-family: "Inter", "Segoe UI", Arial, sans-serif;
            background: white;
            transition: border-color 0.3s ease;
            height: 28px;
        }

        .header-filter:focus {
            outline: none;
            border-color: #805AD5;
            box-shadow: 0 0 0 1px rgba(128, 90, 213, 0.1);
        }

        .header-filter::placeholder {
            color: #9CA3AF;
            font-size: 0.75rem;
        }

        .select-feedback-radio {
            accent-color: #805AD5;
            cursor: pointer;
        }

        .select-feedback-radio:checked {
            background-color: #805AD5;
        }

        tr:hover {
            background: #F8FAFC;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: #D1FAE5;
            color: #065F46;
        }

        .badge-danger {
            background: #FEE2E2;
            color: #991B1B;
        }

        .badge-secondary {
            background: transparent;
            color: #6B7280;
            border: 1px solid #E5E7EB;
        }

        .badge-warning {
            background: #FEF3C7;
            color: #92400E;
        }

        .delete-btn {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .show-image-btn {
            background: linear-gradient(135deg, #805AD5, #4C1D95);
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .show-image-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(128, 90, 213, 0.3);
        }

        /* Image Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            position: relative;
            margin: 5% auto;
            padding: 20px;
            width: 80%;
            max-width: 800px;
            background: white;
            border-radius: 10px;
            text-align: center;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        #modalImage {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 15px;
            background: #F3F4F6;
            color: #6B7280;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #805AD5;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #805AD5, #4C1D95);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(128, 90, 213, 0.2);
        }

        .stat-card h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .radio-group {
                flex-direction: column;
                gap: 15px;
            }

            .button-container {
                flex-direction: column;
                align-items: center;
            }

            .filters {
                grid-template-columns: 1fr;
            }

            .filter-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Trichy Gold Feedback Dashboard</h1>
            <p>Complete Customer Experience Management System</p>
        </div>

        <div class="mode-selector">
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="recorder" name="mode" value="recorder" checked>
                    <label for="recorder">Audio Recorder</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="purchase" name="mode" value="purchase">
                    <label for="purchase">Feedback for Purchase</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="sales" name="mode" value="sales">
                    <label for="sales">Feedback for Sales</label>
                </div>
            </div>
        </div>

        <!-- Recorder Section -->
        <div class="content-section">
            <div class="recorder-section" id="recorderSection" style="display: block !important; visibility: visible !important;">
                <div class="button-container">
                    <button id="recordBtn">Start Recording</button>
                    <button id="stopBtn" disabled>Stop Recording</button>
                    <button id="completeBtn" disabled>Complete & Upload</button>
                </div>
                
                <div class="image-upload-section">
                    <label for="imageUpload" class="image-label">Upload Image (Optional)</label>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                    <div id="imagePreview" class="image-preview"></div>
                </div>
                
                <p id="status" class="status">Press "Start Recording" to begin capturing customer feedback.</p>
                
                <div class="recording-guidance">
                    <h3>üìù Recording Tips for Better Data Extraction</h3>
                    <div class="guidance-content">
                        <div class="guidance-section">
                            <h4>Customer Information:</h4>
                            <ul>
                                <li><strong>IMPORTANT:</strong> Always ask for and specify <strong>customer's contact number/phone number</strong> for follow-up</li>
                                <li>Specify <strong>salesperson name</strong> handling the customer</li>
                                <li>Identify <strong>customer intent</strong>: "Just Looking", "Serious Buyer", "Price Checking", or "Return Customer"</li>
                                <li>Specify if customer is <strong>previous customer</strong> (existing POS customer): "Yes" or "No"</li>
                                <li>Specify <strong>type of customer</strong>: "tourist", "resident", or "none"</li>
                                <li>Specify <strong>M Source</strong> (marketing source): "walkin", "Social Media", "Social Groups", "Whatsup Groups", "Corporates", "Residential Cmty", "Local Cmty", "HNTW", "Hotels", "Tourism Companies", "Tour Drivers", "Other Tours Assctd cmpy", "DGJG", "Product Launch", "Other", or "none"</li>
                                <li>Mention <strong>M Source Tag</strong> (any additional tag/info mentioned in audio)</li>
                            </ul>
                        </div>
                        
                        <div class="guidance-section">
                            <h4>Product Details:</h4>
                            <ul>
                                <li>Specify <strong>item type</strong>: Bangle, Chain, Bracelet, Necklace, Earring, Ring, Pendant Set, Stud, Locket, Hand Chain, Nose Pin, Mangal Sutra, Thali, Band Ring</li>
                                <li>Mention <strong>metal type</strong>: 22K, 18K, 24K, Diamond, Other</li>
                                <li>Describe <strong>design type</strong>: Coins / Bars, Daily Wear, Custom Order, Bridal jewellery, Kids Jewellery, Men's Jewellery, Temple, Antique, Turkish, Calcutta, Delhi, Rajkot, Local, Singapore, Bombay, Italian</li>
                            </ul>
                        </div>
                        
                        <div class="guidance-section">
                            <h4>Size & Weight Issues:</h4>
                            <ul>
                                <li>Specify <strong>required size</strong> vs <strong>available size</strong></li>
                                <li>Specify <strong>required weight</strong> vs <strong>available weight</strong></li>
                                <li>Note if size/weight was a <strong>reason for not buying</strong></li>
                            </ul>
                        </div>
                        
                        <div class="guidance-section">
                            <h4>Purchase Decision:</h4>
                            <ul>
                                <li>Specify if customer <strong>purchased</strong> (Yes/No)</li>
                                <li>If not purchased, identify reasons: <strong>price</strong>, <strong>size</strong>, <strong>weight</strong>, <strong>zero making</strong></li>
                                <li><strong>IMPORTANT - Design Unavailability:</strong> DO NOT just say "unavailable" or "item unavailable". Instead, specify:
                                    <ul style="margin-top: 5px; margin-left: 20px;">
                                        <li><strong>Design Out of Stock</strong> - if a known/existing design is out of stock or not available</li>
                                        <li><strong>Design New</strong> - if customer requested a new/custom design that doesn't exist in the catalog</li>
                                    </ul>
                                </li>
                                <li>Note <strong>asked price</strong> vs <strong>given price</strong></li>
                            </ul>
                        </div>
                        
                        <div class="guidance-section">
                            <h4>Customer Experience:</h4>
                            <ul>
                                <li>Assess <strong>customer mood</strong>: Happy, Frustrated, Neutral, Disappointed</li>
                                <li>Check <strong>design preference</strong>: Liked, Disliked, Neutral</li>
                                <li>Evaluate <strong>store impression</strong>: Good, Poor, Neutral</li>
                                <li>Rate <strong>customer support</strong>: Excellent, Good, Average, Poor</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Purchase Analysis Section -->
        <div class="content-section">
            <div class="filter-section" id="purchaseSection">
                <div class="stats-grid" id="purchaseStatsGrid">
                    <!-- Stats will be populated by JavaScript -->
                </div>

                <div class="table-info">
                    <span id="purchaseTotalRecords">Total Records: 0</span>
                </div>

                <div class="table-container">
                    <table id="purchaseTable">
                        <thead>
                            <tr>
                                <th style="width: 40px;"></th>
                                <th style="width: 50px;">#</th>
                                <th style="width: 100px;">Purchased</th>
                                <th style="width: 100px;">Salesperson</th>
                                <th style="width: 110px;">Customer Intent</th>
                        <th style="width: 100px;">Contact Number</th>
                        <th style="width: 100px;">Type of Customer</th>
                        <th style="width: 120px;">M Source</th>
                        <th style="width: 120px;">M Source Tag</th>
                        <th style="width: 90px;">Item Type</th>
                        <th style="width: 80px;">Metal Type</th>
                        <th style="width: 100px;">Design Type</th>
                        <th style="width: 80px;">Size Issue</th>
                        <th style="width: 80px;">Weight Issue</th>
                        <th style="width: 100px;">Design Out of Stock</th>
                        <th style="width: 100px;">Design New</th>
                        <th style="width: 80px;">Avail Size</th>
                                <th style="width: 80px;">Req Size</th>
                        <th style="width: 80px;">Avail Weight</th>
                        <th style="width: 80px;">Req Weight</th>
                        <th style="width: 100px;">Image</th>
                        <th style="width: 80px;">Actions</th>
                            </tr>
                            <tr class="filter-row">
                                <th><!-- No filter for radio button --></th>
                                <th><!-- No filter for # --></th>
                                <th>
                                    <select id="purchasePurchasedFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="purchaseSalespersonFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Mohideen">Mohideen</option>
                                        <option value="Kannan">Kannan</option>
                                        <option value="Rahul">Rahul</option>
                                        <option value="Samim">Samim</option>
                                        <option value="Abu Sufian">Abu Sufian</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="purchaseIntentFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Just Looking">Just Looking</option>
                                        <option value="Serious Buyer">Serious Buyer</option>
                                        <option value="Price Checking">Price Checking</option>
                                        <option value="Return Customer">Return Customer</option>
                                    </select>
                                </th>
                                <th><input type="text" id="purchaseContactFilter" placeholder="Filter Contact" class="header-filter"></th>
                                <th>
                                    <select id="purchaseTypeOfCustomerFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="tourist">Tourist</option>
                                        <option value="resident">Resident</option>
                                        <option value="none">None</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="purchaseMSourceFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="walkin">Walkin</option>
                                        <option value="Social Media">Social Media</option>
                                        <option value="Social Groups">Social Groups</option>
                                        <option value="Whatsup Groups">WhatsApp Groups</option>
                                        <option value="Corporates">Corporates</option>
                                        <option value="Residential Cmty">Residential Cmty</option>
                                        <option value="Local Cmty">Local Cmty</option>
                                        <option value="HNTW">HNTW</option>
                                        <option value="Hotels">Hotels</option>
                                        <option value="Tourism Companies">Tourism Companies</option>
                                        <option value="Tour Drivers">Tour Drivers</option>
                                        <option value="Other Tours Assctd cmpy">Other Tours Assctd cmpy</option>
                                        <option value="DGJG">DGJG</option>
                                        <option value="Product Launch">Product Launch</option>
                                        <option value="Other">Other</option>
                                        <option value="none">None</option>
                                    </select>
                                </th>
                                <th><input type="text" id="purchaseMSourceTagFilter" placeholder="Filter M Source Tag" class="header-filter"></th>
                                <th>
                                    <select id="purchaseItemTypeFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Bangle">Bangle</option>
                                        <option value="Chain">Chain</option>
                                        <option value="Bracelet">Bracelet</option>
                                        <option value="Necklace">Necklace</option>
                                        <option value="Earring">Earring</option>
                                        <option value="Ring">Ring</option>
                                        <option value="Pendant Set">Pendant Set</option>
                                        <option value="Stud">Stud</option>
                                        <option value="Locket">Locket</option>
                                        <option value="Hand Chain">Hand Chain</option>
                                        <option value="Nose Pin">Nose Pin</option>
                                        <option value="Mangal Sutra">Mangal Sutra</option>
                                        <option value="Thali">Thali</option>
                                        <option value="Band Ring">Band Ring</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="purchaseMetalTypeFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="22K">22K</option>
                                        <option value="18K">18K</option>
                                        <option value="24K">24K</option>
                                        <option value="Diamond">Diamond</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="purchaseDesignFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Coins / Bars">Coins / Bars</option>
                                        <option value="Daily Wear">Daily Wear</option>
                                        <option value="Custom Order">Custom Order</option>
                                        <option value="Bridal jewellery">Bridal jewellery</option>
                                        <option value="Kids Jewellery">Kids Jewellery</option>
                                        <option value="Men's Jewellery">Men's Jewellery</option>
                                        <option value="Temple">Temple</option>
                                        <option value="Antique">Antique</option>
                                        <option value="Turkish">Turkish</option>
                                        <option value="Calcutta">Calcutta</option>
                                        <option value="Delhi">Delhi</option>
                                        <option value="Rajkot">Rajkot</option>
                                        <option value="Local">Local</option>
                                        <option value="Singapore">Singapore</option>
                                        <option value="Bombay">Bombay</option>
                                        <option value="Italian">Italian</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="purchaseSizeIssueFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                </th>
                            <th>
                                <select id="purchaseWeightIssueFilter" class="header-filter">
                                    <option value="All">All</option>
                                    <option value="Empty">No Value</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </th>
                            <th>
                                <select id="purchaseDesignOutOfStockFilter" class="header-filter">
                                    <option value="All">All</option>
                                    <option value="Empty">No Value</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </th>
                            <th>
                                <select id="purchaseDesignNewFilter" class="header-filter">
                                    <option value="All">All</option>
                                    <option value="Empty">No Value</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </th>
                                <th><input type="text" id="purchaseAvailSizeFilter" placeholder="Avail Size" class="header-filter"></th>
                                <th><input type="text" id="purchaseReqSizeFilter" placeholder="Req Size" class="header-filter"></th>
                                <th><input type="text" id="purchaseAvailWeightFilter" placeholder="Avail Weight" class="header-filter"></th>
                                <th><input type="text" id="purchaseReqWeightFilter" placeholder="Req Weight" class="header-filter"></th>
                                <th><!-- No filter for image --></th>
                                <th><!-- No filter for actions --></th>
                            </tr>
                        </thead>
                        <tbody id="purchaseTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="purchasePagination">
                    <!-- Pagination buttons will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Sales Analysis Section -->
        <div class="content-section">
            <div class="filter-section" id="salesSection">
                <div class="stats-grid" id="salesStatsGrid">
                    <!-- Stats will be populated by JavaScript -->
                </div>

                <div class="table-info">
                    <span id="salesTotalRecords">Total Records: 0</span>
                </div>

                <div class="table-container">
                    <table id="salesTable">
                        <thead>
                            <tr>
                                <th style="width: 40px;"></th>
                                <th style="width: 50px;">#</th>
                                <th style="width: 100px;">Purchased</th>
                                <th style="width: 100px;">Salesperson</th>
                                <th style="width: 110px;">Customer Intent</th>
                                <th style="width: 100px;">Contact</th>
                                <th style="width: 90px;">Item Type</th>
                                <th style="width: 80px;">Metal</th>
                                <th style="width: 100px;">Design Type</th>
                                <th style="width: 80px;">Price Issue</th>
                                <th style="width: 80px;">Zero Making</th>
                                <th style="width: 80px;">Design Preference</th>
                                <th style="width: 80px;">Customer Mood</th>
                                <th style="width: 80px;">Store Impression</th>
                                <th style="width: 80px;">Actions</th>
                            </tr>
                            <tr class="filter-row">
                                <th><!-- No filter for radio button --></th>
                                <th><!-- No filter for # --></th>
                                <th>
                                    <select id="salesPurchasedFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesSalespersonFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Mohideen">Mohideen</option>
                                        <option value="Kannan">Kannan</option>
                                        <option value="Rahul">Rahul</option>
                                        <option value="Samim">Samim</option>
                                        <option value="Abu Sufian">Abu Sufian</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesIntentFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Just Looking">Just Looking</option>
                                        <option value="Serious Buyer">Serious Buyer</option>
                                        <option value="Price Checking">Price Checking</option>
                                        <option value="Return Customer">Return Customer</option>
                                    </select>
                                </th>
                                <th><input type="text" id="salesContactFilter" placeholder="Filter Contact" class="header-filter"></th>
                                <th>
                                    <select id="salesItemTypeFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Bangle">Bangle</option>
                                        <option value="Chain">Chain</option>
                                        <option value="Bracelet">Bracelet</option>
                                        <option value="Necklace">Necklace</option>
                                        <option value="Earring">Earring</option>
                                        <option value="Ring">Ring</option>
                                        <option value="Pendant Set">Pendant Set</option>
                                        <option value="Stud">Stud</option>
                                        <option value="Locket">Locket</option>
                                        <option value="Hand Chain">Hand Chain</option>
                                        <option value="Nose Pin">Nose Pin</option>
                                        <option value="Mangal Sutra">Mangal Sutra</option>
                                        <option value="Thali">Thali</option>
                                        <option value="Band Ring">Band Ring</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesMetalTypeFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="22K">22K</option>
                                        <option value="18K">18K</option>
                                        <option value="24K">24K</option>
                                        <option value="Diamond">Diamond</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesDesignFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Coins / Bars">Coins / Bars</option>
                                        <option value="Daily Wear">Daily Wear</option>
                                        <option value="Custom Order">Custom Order</option>
                                        <option value="Bridal jewellery">Bridal jewellery</option>
                                        <option value="Kids Jewellery">Kids Jewellery</option>
                                        <option value="Men's Jewellery">Men's Jewellery</option>
                                        <option value="Temple">Temple</option>
                                        <option value="Antique">Antique</option>
                                        <option value="Turkish">Turkish</option>
                                        <option value="Calcutta">Calcutta</option>
                                        <option value="Delhi">Delhi</option>
                                        <option value="Rajkot">Rajkot</option>
                                        <option value="Local">Local</option>
                                        <option value="Singapore">Singapore</option>
                                        <option value="Bombay">Bombay</option>
                                        <option value="Italian">Italian</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesPriceIssueFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesZeroMakingFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesDesignPreferenceFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Liked">Liked</option>
                                        <option value="Disliked">Disliked</option>
                                        <option value="Neutral">Neutral</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesCustomerMoodFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Happy">Happy</option>
                                        <option value="Frustrated">Frustrated</option>
                                        <option value="Neutral">Neutral</option>
                                        <option value="Disappointed">Disappointed</option>
                                    </select>
                                </th>
                                <th>
                                    <select id="salesStoreImpressionFilter" class="header-filter">
                                        <option value="All">All</option>
                                        <option value="Empty">No Value</option>
                                        <option value="Good">Good</option>
                                        <option value="Poor">Poor</option>
                                        <option value="Neutral">Neutral</option>
                                    </select>
                                </th>
                                <th><!-- No filter for actions --></th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="salesPagination">
                    <!-- Pagination buttons will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mode switching
        document.querySelectorAll('input[name="mode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                console.log('Mode changed to:', this.value);
                
                // Get all content sections - use parent elements of inner sections for reliability
                const recorderSectionEl = document.querySelector('#recorderSection');
                const purchaseSectionEl = document.querySelector('#purchaseSection');
                const salesSectionEl = document.querySelector('#salesSection');
                
                const recorderSection = recorderSectionEl ? recorderSectionEl.parentElement : null;
                const purchaseSection = purchaseSectionEl ? purchaseSectionEl.parentElement : null;
                const salesSection = salesSectionEl ? salesSectionEl.parentElement : null;
                
                console.log('Sections found:', {
                    recorder: !!recorderSection,
                    purchase: !!purchaseSection,
                    sales: !!salesSection
                });
                
                // Hide all sections first - use !important to override CSS
                if (recorderSection) {
                    recorderSection.style.setProperty('display', 'none', 'important');
                }
                if (purchaseSection) {
                    purchaseSection.style.setProperty('display', 'none', 'important');
                }
                if (salesSection) {
                    salesSection.style.setProperty('display', 'none', 'important');
                }
                
                console.log('All sections hidden');
                
                if (this.value === 'recorder') {
                    console.log('Showing recorder section');
                    if (recorderSection) {
                        recorderSection.style.setProperty('display', 'block', 'important');
                        console.log('Recorder section displayed');
                    } else {
                        console.error('Recorder section not found!');
                    }
                } else if (this.value === 'purchase') {
                    console.log('Showing purchase section');
                    if (purchaseSection) {
                        purchaseSection.style.setProperty('display', 'block', 'important');
                        console.log('Purchase section displayed');
                        loadPurchaseData();
                    } else {
                        console.error('Purchase section not found!');
                    }
                } else if (this.value === 'sales') {
                    console.log('Showing sales section');
                    if (salesSection) {
                        salesSection.style.setProperty('display', 'block', 'important');
                        console.log('Sales section displayed');
                        loadSalesData();
                    } else {
                        console.error('Sales section not found!');
                    }
                }
            });
        });

        // Recorder functionality (existing code)
        let mediaRecorder;
        let chunks = [];
        let isRecording = false;
        let hasRecorded = false;
        let selectedImage = null;

        async function processAudio(formData) {
            try {
                console.log("Sending request to /process_audio");
                console.log("FormData contents:");
                for (let [key, value] of formData.entries()) {
                    console.log(key, value);
                }
                
                const response = await fetch("/process_audio", {
                    method: "POST",
                    body: formData
                });

                console.log("Response status:", response.status);
                console.log("Response headers:", response.headers);
                
                const result = await response.json();
                console.log("Response result:", result);
                
                // Log image debug info if present
                if (result.image_debug) {
                    console.log("=== IMAGE DEBUG INFO ===");
                    console.log("Image URL:", result.image_debug.image_url);
                    console.log("Unique filename:", result.image_debug.unique_filename);
                    console.log("Original filename:", result.image_debug.filename);
                    console.log("Image saved:", result.image_debug.image_saved);
                    console.log("========================");
                    
                    if (!result.image_debug.image_saved) {
                        console.warn("‚ö†Ô∏è WARNING: Image was NOT saved to disk!");
                    }
                }
                
                const status = document.getElementById("status");

                if (response.ok) {
                    status.textContent = "Data saved successfully to MongoDB.";
                    status.className = "status success";
                    resetButtons();
                } else {
                    status.textContent = "Server error: " + result.detail;
                    status.className = "status error";
                }
            } catch (err) {
                console.error("Error in processAudio:", err);
                const status = document.getElementById("status");
                status.textContent = "Failed to connect to backend: " + err.message;
                status.className = "status error";
            }
        }

        function resetButtons() {
            document.getElementById("recordBtn").disabled = false;
            document.getElementById("stopBtn").disabled = true;
            document.getElementById("completeBtn").disabled = true;
            isRecording = false;
            hasRecorded = false;
            chunks = [];
            selectedImage = null;
            document.getElementById("imagePreview").innerHTML = "";
            document.getElementById("imageUpload").value = "";
        }

        function updateButtonStates() {
            const recordBtn = document.getElementById("recordBtn");
            const stopBtn = document.getElementById("stopBtn");
            const completeBtn = document.getElementById("completeBtn");

            if (isRecording) {
                recordBtn.disabled = true;
                stopBtn.disabled = false;
                completeBtn.disabled = true;
            } else if (hasRecorded) {
                recordBtn.disabled = false;
                stopBtn.disabled = true;
                completeBtn.disabled = false;
            } else {
                recordBtn.disabled = false;
                stopBtn.disabled = true;
                completeBtn.disabled = true;
            }
        }

        // Image upload handling
        document.getElementById("imageUpload").addEventListener("change", function(e) {
            const file = e.target.files[0];
            console.log("Image file selected:", file);
            if (file) {
                selectedImage = file;
                console.log("Image stored in selectedImage:", selectedImage.name, selectedImage.size);
                const preview = document.getElementById("imagePreview");
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Selected image">`;
                };
                reader.readAsDataURL(file);
            } else {
                selectedImage = null;
                console.log("Image cleared");
                document.getElementById("imagePreview").innerHTML = "";
            }
        });

        // Start Recording Button
        document.getElementById("recordBtn").onclick = async () => {
            const status = document.getElementById("status");

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                chunks = [];

                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = () => {
                    hasRecorded = true;
                    updateButtonStates();
                    status.textContent = "Recording stopped. Click 'Complete & Upload' to process.";
                    status.className = "status";
                };

                mediaRecorder.start();
                isRecording = true;
                updateButtonStates();
                status.className = "status recording";

                // Add wave animation
                let remaining = 25;
                const wave = document.createElement("span");
                wave.className = "wave";
                wave.innerHTML = "‚óè ‚óè ‚óè ‚óè ‚óè";
                status.innerHTML = `Recording audio... (${remaining}s remaining) `;
                status.appendChild(wave);

                let wavePhase = 0;
                const waveAnim = setInterval(() => {
                    wave.innerHTML = "‚óè ‚óè ‚óè ‚óè ‚óè"
                        .split(" ")
                        .map((dot, i) =>
                            i === wavePhase % 5 ? `<span style="color:#f44336;">${dot}</span>` : dot
                        )
                        .join(" ");
                    wavePhase++;
                }, 200);

                // Countdown timer
                const countdown = setInterval(() => {
                    remaining--;
                    if (remaining > 0 && isRecording) {
                        status.innerHTML = `Recording audio... (${remaining}s remaining) `;
                        status.appendChild(wave);
                    } else {
                        clearInterval(countdown);
                    }
                }, 1000);

                // Auto stop after 25s
                setTimeout(() => {
                    if (mediaRecorder.state === "recording") {
                        mediaRecorder.stop();
                        isRecording = false;
                        updateButtonStates();
                        status.textContent = "Recording auto-stopped after 25 seconds. Click 'Complete & Upload' to process.";
                        status.className = "status";
                    }
                    clearInterval(waveAnim);
                    clearInterval(countdown);
                }, 25000);

            } catch (error) {
                status.textContent = "Error accessing microphone: " + error.message;
                status.className = "status error";
                isRecording = false;
                updateButtonStates();
            }
        };

        // Stop Recording Button
        document.getElementById("stopBtn").onclick = () => {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                isRecording = false;
                updateButtonStates();
                const status = document.getElementById("status");
                status.textContent = "Recording stopped manually. Click 'Complete & Upload' to process.";
                status.className = "status";
            }
        };

        // Complete & Upload Button
        document.getElementById("completeBtn").onclick = async () => {
            if (chunks.length > 0) {
                const status = document.getElementById("status");
                status.textContent = "Processing audio...";
                status.className = "status processing";

                const blob = new Blob(chunks, { type: 'audio/webm' });
                const file = new File([blob], "feedback.webm", { type: 'audio/webm' });
                const formData = new FormData();
                formData.append("file", file);
                
                // Add image if selected
                if (selectedImage) {
                    console.log("Adding image to FormData:", selectedImage.name, selectedImage.size);
                    formData.append("image", selectedImage);
                } else {
                    console.log("No image selected");
                }
                
                await processAudio(formData);
            }
        };

        // Add event listeners for auto-filtering
        // Initialize the page - show recorder by default
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing page...');
            
            // Show recorder section by default (don't hide it initially)
            const recorderSectionEl = document.querySelector('#recorderSection');
            const recorderSection = recorderSectionEl ? recorderSectionEl.parentElement : null;
            if (recorderSection) {
                recorderSection.style.setProperty('display', 'block', 'important');
                console.log('Recorder section displayed by default');
                console.log('Recorder section element:', recorderSection);
                console.log('Recorder section computed style:', window.getComputedStyle(recorderSection).display);
            } else {
                console.error('Recorder section not found!');
            }
            
            // Hide other sections - use ID-based selectors
            const purchaseSectionEl = document.querySelector('#purchaseSection');
            const salesSectionEl = document.querySelector('#salesSection');
            const purchaseSection = purchaseSectionEl ? purchaseSectionEl.parentElement : null;
            const salesSection = salesSectionEl ? salesSectionEl.parentElement : null;
            
            if (purchaseSection) {
                purchaseSection.style.setProperty('display', 'none', 'important');
                console.log('Purchase section hidden');
            }
            if (salesSection) {
                salesSection.style.setProperty('display', 'none', 'important');
                console.log('Sales section hidden');
            }
            
            // Add event listeners to all header filters
            const headerFilters = document.querySelectorAll('.header-filter');
            console.log('Found', headerFilters.length, 'header filters');
            
            headerFilters.forEach((filter, index) => {
                console.log(`Setting up listener for filter ${index}:`, filter.id);
                filter.addEventListener('input', function() {
                    console.log('Filter input changed:', filter.id, '=', filter.value);
                    applyFilters();
                });
                filter.addEventListener('change', function() {
                    console.log('Filter change:', filter.id, '=', filter.value);
                    applyFilters();
                });
            });
        });

        // Purchase and Sales Table functionality
        let purchaseCurrentPage = 1;
        let purchaseTotalPages = 1;
        let purchaseData = [];
        let allPurchaseData = [];
        
        let salesCurrentPage = 1;
        let salesTotalPages = 1;
        let salesData = [];
        let allSalesData = [];

        async function loadPurchaseData() {
            try {
                console.log('Loading purchase data...');
                const response = await fetch('/api/feedback');
                console.log('Response received:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Purchase data received:', data.length, 'records');
                
                allPurchaseData = data;
                purchaseData = data;
                updatePurchaseStats();
                renderPurchaseTable();
                setupPurchaseFilters();
            } catch (error) {
                console.error('Error loading purchase data:', error);
                document.getElementById('purchaseTableBody').innerHTML = 
                    '<tr><td colspan="16" style="text-align: center; color: #EF4444;">Error loading data: ' + error.message + '</td></tr>';
            }
        }

        async function loadSalesData() {
            try {
                console.log('Loading sales data...');
                const response = await fetch('/api/feedback');
                console.log('Response received:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Sales data received:', data.length, 'records');
                
                allSalesData = data;
                salesData = data;
                updateSalesStats();
                renderSalesTable();
                setupSalesFilters();
            } catch (error) {
                console.error('Error loading sales data:', error);
                document.getElementById('salesTableBody').innerHTML = 
                    '<tr><td colspan="15" style="text-align: center; color: #EF4444;">Error loading data: ' + error.message + '</td></tr>';
            }
        }

        function updatePurchaseStats() {
            const statsGrid = document.getElementById('purchaseStatsGrid');
            const totalRecords = document.getElementById('purchaseTotalRecords');
            const total = purchaseData.length;
            const purchased = purchaseData.filter(item => item.purchased === 'Yes').length;
            const sizeIssues = purchaseData.filter(item => item.reason_size === 'Yes').length;
            const weightIssues = purchaseData.filter(item => item.reason_weight === 'Yes').length;
            const designOutofstock = purchaseData.filter(item => item.reason_design_outofstock === 'Yes').length;
            const designNew = purchaseData.filter(item => item.reason_design_new === 'Yes').length;

            totalRecords.textContent = `Total Records: ${total}`;

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3>${total}</h3>
                    <p>Total Feedback</p>
                </div>
                <div class="stat-card">
                    <h3>${purchased}</h3>
                    <p>Purchases</p>
                </div>
                <div class="stat-card">
                    <h3>${sizeIssues}</h3>
                    <p>Size Issues</p>
                </div>
                <div class="stat-card">
                    <h3>${weightIssues}</h3>
                    <p>Weight Issues</p>
                </div>
                <div class="stat-card">
                    <h3>${designOutofstock}</h3>
                    <p>Design Out of Stock</p>
                </div>
                <div class="stat-card">
                    <h3>${designNew}</h3>
                    <p>Design New</p>
                </div>
            `;
        }

        function updateSalesStats() {
            const statsGrid = document.getElementById('salesStatsGrid');
            const totalRecords = document.getElementById('salesTotalRecords');
            const total = salesData.length;
            const purchased = salesData.filter(item => item.purchased === 'Yes').length;
            const priceIssues = salesData.filter(item => item.reason_price === 'Yes').length;
            const frustrated = salesData.filter(item => item.customer_mood === 'Frustrated').length;

            totalRecords.textContent = `Total Records: ${total}`;

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3>${total}</h3>
                    <p>Total Feedback</p>
                </div>
                <div class="stat-card">
                    <h3>${purchased}</h3>
                    <p>Purchases</p>
                </div>
                <div class="stat-card">
                    <h3>${priceIssues}</h3>
                    <p>Price Issues</p>
                </div>
                <div class="stat-card">
                    <h3>${frustrated}</h3>
                    <p>Frustrated Customers</p>
                </div>
            `;
        }

        function renderPurchaseTable() {
            console.log('renderPurchaseTable called with', purchaseData.length, 'records');
            const tbody = document.getElementById('purchaseTableBody');
            
            if (!tbody) {
                console.error('Purchase table body element not found!');
                return;
            }
            
            const startIndex = (purchaseCurrentPage - 1) * 25;
            const endIndex = startIndex + 25;
            const pageData = purchaseData.slice(startIndex, endIndex);
            
            tbody.innerHTML = pageData.map((item, index) => `
                <tr>
                    <td><input type="radio" name="selected_purchase" value="${item._id}" class="select-feedback-radio"></td>
                    <td>${startIndex + index + 1}</td>
                    <td>
                        <span class="badge ${item.purchased === 'Yes' ? 'badge-success' : item.purchased === 'No' ? 'badge-danger' : 'badge-secondary'}">
                            ${item.purchased || '‚Äî'}
                        </span>
                    </td>
                    <td>${item.salesperson_name || '‚Äî'}</td>
                    <td>
                        <span class="badge ${item.customer_intent === 'Serious Buyer' ? 'badge-success' : item.customer_intent === 'Just Looking' ? 'badge-warning' : 'badge-secondary'}">
                            ${item.customer_intent || '‚Äî'}
                        </span>
                    </td>
                    <td>${item.contact_number || '‚Äî'}</td>
                    <td>
                        <span class="badge ${item.type_of_customer === 'tourist' ? 'badge-warning' : item.type_of_customer === 'resident' ? 'badge-success' : 'badge-secondary'}">
                            ${item.type_of_customer || '‚Äî'}
                        </span>
                    </td>
                    <td>${item.M_Source || '‚Äî'}</td>
                    <td>${item.M_source_Tag || '‚Äî'}</td>
                    <td>${item.item_type || '‚Äî'}</td>
                    <td>${item.metal_type || '‚Äî'}</td>
                    <td>${item.design_type || '‚Äî'}</td>
                    <td>
                        <span class="badge ${item.reason_size === 'Yes' ? 'badge-danger' : item.reason_size === 'No' ? 'badge-success' : 'badge-secondary'}">
                            ${item.reason_size || '‚Äî'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.reason_weight === 'Yes' ? 'badge-danger' : item.reason_weight === 'No' ? 'badge-success' : 'badge-secondary'}">
                            ${item.reason_weight || '‚Äî'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.reason_design_outofstock === 'Yes' ? 'badge-danger' : item.reason_design_outofstock === 'No' ? 'badge-success' : 'badge-secondary'}">
                            ${item.reason_design_outofstock || '‚Äî'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.reason_design_new === 'Yes' ? 'badge-danger' : item.reason_design_new === 'No' ? 'badge-success' : 'badge-secondary'}">
                            ${item.reason_design_new || '‚Äî'}
                        </span>
                    </td>
                    <td>${item.available_size || '‚Äî'}</td>
                    <td>${item.required_size || '‚Äî'}</td>
                    <td>${item.available_weight || '‚Äî'}</td>
                    <td>${item.required_weight || '‚Äî'}</td>
                    <td>
                        ${item.image_url ? 
                            `<button class="show-image-btn" onclick="console.log('Image URL from table:', '${item.image_url}'); showImage('${item.image_url}')">Show Image</button>` : 
                            '‚Äî'
                        }
                    </td>
                    <td>
                        <button class="delete-btn" onclick="deleteFeedback('${item._id}')">Delete</button>
                    </td>
                </tr>
            `).join('');

            updatePurchasePagination();
        }

        function renderSalesTable() {
            console.log('renderSalesTable called with', salesData.length, 'records');
            const tbody = document.getElementById('salesTableBody');
            
            if (!tbody) {
                console.error('Sales table body element not found!');
                return;
            }
            
            const startIndex = (salesCurrentPage - 1) * 25;
            const endIndex = startIndex + 25;
            const pageData = salesData.slice(startIndex, endIndex);
            
            tbody.innerHTML = pageData.map((item, index) => `
                <tr>
                    <td><input type="radio" name="selected_sales" value="${item._id}" class="select-feedback-radio"></td>
                    <td>${startIndex + index + 1}</td>
                    <td>
                        <span class="badge ${item.purchased === 'Yes' ? 'badge-success' : item.purchased === 'No' ? 'badge-danger' : 'badge-secondary'}">
                            ${item.purchased || '‚Äî'}
                        </span>
                    </td>
                    <td>${item.salesperson_name || '‚Äî'}</td>
                    <td>
                        <span class="badge ${item.customer_intent === 'Serious Buyer' ? 'badge-success' : item.customer_intent === 'Just Looking' ? 'badge-warning' : 'badge-secondary'}">
                            ${item.customer_intent || '‚Äî'}
                        </span>
                    </td>
                    <td>${item.contact_number || '‚Äî'}</td>
                    <td>${item.item_type || '‚Äî'}</td>
                    <td>${item.metal_type || '‚Äî'}</td>
                    <td>${item.design_type || '‚Äî'}</td>
                    <td>
                        <span class="badge ${item.reason_price === 'Yes' ? 'badge-danger' : item.reason_price === 'No' ? 'badge-success' : 'badge-secondary'}">
                            ${item.reason_price || '‚Äî'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.reason_zeromaking === 'Yes' ? 'badge-danger' : item.reason_zeromaking === 'No' ? 'badge-success' : 'badge-secondary'}">
                            ${item.reason_zeromaking || '‚Äî'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.design_preference === 'Liked' ? 'badge-success' : item.design_preference === 'Disliked' ? 'badge-danger' : 'badge-secondary'}">
                            ${item.design_preference || '‚Äî'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.customer_mood === 'Happy' ? 'badge-success' : item.customer_mood === 'Frustrated' ? 'badge-danger' : item.customer_mood === 'Disappointed' ? 'badge-warning' : 'badge-secondary'}">
                            ${item.customer_mood || '‚Äî'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${item.store_impression === 'Good' ? 'badge-success' : item.store_impression === 'Poor' ? 'badge-danger' : 'badge-secondary'}">
                            ${item.store_impression || '‚Äî'}
                        </span>
                    </td>
                    <td>
                        <button class="delete-btn" onclick="deleteFeedback('${item._id}')">Delete</button>
                    </td>
                </tr>
            `).join('');

            updateSalesPagination();
        }

        function updatePagination() {
            totalPages = Math.ceil(feedbackData.length / 25);
            const pagination = document.getElementById('pagination');
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `<button ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">Previous</button>`;
            
            // Page numbers
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                paginationHTML += `<button ${i === currentPage ? 'disabled' : ''} onclick="changePage(${i})">${i}</button>`;
            }
            
            // Next button
            paginationHTML += `<button ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">Next</button>`;
            
            pagination.innerHTML = paginationHTML;
        }

        function updatePurchasePagination() {
            purchaseTotalPages = Math.ceil(purchaseData.length / 25);
            const pagination = document.getElementById('purchasePagination');
            
            if (!pagination) {
                console.error('Purchase pagination element not found!');
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `<button ${purchaseCurrentPage === 1 ? 'disabled' : ''} onclick="changePurchasePage(${purchaseCurrentPage - 1})">Previous</button>`;
            
            // Page numbers
            for (let i = Math.max(1, purchaseCurrentPage - 2); i <= Math.min(purchaseTotalPages, purchaseCurrentPage + 2); i++) {
                paginationHTML += `<button ${i === purchaseCurrentPage ? 'disabled' : ''} onclick="changePurchasePage(${i})">${i}</button>`;
            }
            
            // Next button
            paginationHTML += `<button ${purchaseCurrentPage === purchaseTotalPages ? 'disabled' : ''} onclick="changePurchasePage(${purchaseCurrentPage + 1})">Next</button>`;
            
            pagination.innerHTML = paginationHTML;
        }

        function updateSalesPagination() {
            salesTotalPages = Math.ceil(salesData.length / 25);
            const pagination = document.getElementById('salesPagination');
            
            if (!pagination) {
                console.error('Sales pagination element not found!');
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `<button ${salesCurrentPage === 1 ? 'disabled' : ''} onclick="changeSalesPage(${salesCurrentPage - 1})">Previous</button>`;
            
            // Page numbers
            for (let i = Math.max(1, salesCurrentPage - 2); i <= Math.min(salesTotalPages, salesCurrentPage + 2); i++) {
                paginationHTML += `<button ${i === salesCurrentPage ? 'disabled' : ''} onclick="changeSalesPage(${i})">${i}</button>`;
            }
            
            // Next button
            paginationHTML += `<button ${salesCurrentPage === salesTotalPages ? 'disabled' : ''} onclick="changeSalesPage(${salesCurrentPage + 1})">Next</button>`;
            
            pagination.innerHTML = paginationHTML;
        }

        function changePage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderTable();
            }
        }

        function changePurchasePage(page) {
            if (page >= 1 && page <= purchaseTotalPages) {
                purchaseCurrentPage = page;
                renderPurchaseTable();
            }
        }

        function changeSalesPage(page) {
            if (page >= 1 && page <= salesTotalPages) {
                salesCurrentPage = page;
                renderSalesTable();
            }
        }

        function setupPurchaseFilters() {
            console.log('Setting up purchase filters...');
            document.querySelectorAll('#purchaseSection .header-filter').forEach(filter => {
                filter.addEventListener('input', () => {
                    console.log('Purchase filter changed:', filter.id, filter.value);
                    applyPurchaseFilters();
                });
                filter.addEventListener('change', () => {
                    console.log('Purchase filter changed:', filter.id, filter.value);
                    applyPurchaseFilters();
                });
            });
        }

        function setupSalesFilters() {
            console.log('Setting up sales filters...');
            document.querySelectorAll('#salesSection .header-filter').forEach(filter => {
                filter.addEventListener('input', () => {
                    console.log('Sales filter changed:', filter.id, filter.value);
                    applySalesFilters();
                });
                filter.addEventListener('change', () => {
                    console.log('Sales filter changed:', filter.id, filter.value);
                    applySalesFilters();
                });
            });
        }

        function applyPurchaseFilters() {
            console.log('applyPurchaseFilters called - client-side filtering');
            
            // Start with all data
            let filtered = [...allPurchaseData];
            
            // Apply each filter
            const purchased = document.getElementById('purchasePurchasedFilter').value;
            const salesperson = document.getElementById('purchaseSalespersonFilter').value;
            const customerIntent = document.getElementById('purchaseIntentFilter').value;
            const contact = document.getElementById('purchaseContactFilter').value;
            const typeOfCustomer = document.getElementById('purchaseTypeOfCustomerFilter').value;
            const mSource = document.getElementById('purchaseMSourceFilter').value;
            const mSourceTag = document.getElementById('purchaseMSourceTagFilter').value;
            const itemType = document.getElementById('purchaseItemTypeFilter').value;
            const metalType = document.getElementById('purchaseMetalTypeFilter').value;
            const designType = document.getElementById('purchaseDesignFilter').value;
            const sizeIssue = document.getElementById('purchaseSizeIssueFilter').value;
            const weightIssue = document.getElementById('purchaseWeightIssueFilter').value;
            const designOutofstock = document.getElementById('purchaseDesignOutOfStockFilter').value;
            const designNew = document.getElementById('purchaseDesignNewFilter').value;
            const availSize = document.getElementById('purchaseAvailSizeFilter').value;
            const reqSize = document.getElementById('purchaseReqSizeFilter').value;
            const availWeight = document.getElementById('purchaseAvailWeightFilter').value;
            const reqWeight = document.getElementById('purchaseReqWeightFilter').value;
            
            // Filter by Purchased
            if (purchased !== 'All') {
                if (purchased === 'Empty') {
                    filtered = filtered.filter(item => !item.purchased || item.purchased === '');
                } else {
                    filtered = filtered.filter(item => item.purchased === purchased);
                }
            }
            
            // Filter by Salesperson
            if (salesperson !== 'All') {
                if (salesperson === 'Empty') {
                    filtered = filtered.filter(item => !item.salesperson_name || item.salesperson_name === '');
                } else {
                    filtered = filtered.filter(item => item.salesperson_name === salesperson);
                }
            }
            
            // Filter by Customer Intent
            if (customerIntent !== 'All') {
                if (customerIntent === 'Empty') {
                    filtered = filtered.filter(item => !item.customer_intent || item.customer_intent === '');
                } else {
                    filtered = filtered.filter(item => item.customer_intent === customerIntent);
                }
            }
            
            // Filter by Contact (text search)
            if (contact) {
                filtered = filtered.filter(item => 
                    item.contact_number && item.contact_number.toLowerCase().includes(contact.toLowerCase())
                );
            }
            
            // Filter by Type of Customer
            if (typeOfCustomer !== 'All') {
                if (typeOfCustomer === 'Empty') {
                    filtered = filtered.filter(item => !item.type_of_customer || item.type_of_customer === '');
                } else {
                    filtered = filtered.filter(item => item.type_of_customer === typeOfCustomer);
                }
            }
            
            // Filter by M Source
            if (mSource !== 'All') {
                if (mSource === 'Empty') {
                    filtered = filtered.filter(item => !item.M_Source || item.M_Source === '');
                } else {
                    filtered = filtered.filter(item => item.M_Source === mSource);
                }
            }
            
            // Filter by M Source Tag (text search)
            if (mSourceTag) {
                filtered = filtered.filter(item => 
                    item.M_source_Tag && item.M_source_Tag.toLowerCase().includes(mSourceTag.toLowerCase())
                );
            }
            
            // Filter by Item Type
            if (itemType !== 'All') {
                if (itemType === 'Empty') {
                    filtered = filtered.filter(item => !item.item_type || item.item_type === '');
                } else {
                    filtered = filtered.filter(item => item.item_type === itemType);
                }
            }
            
            // Filter by Metal Type
            if (metalType !== 'All') {
                if (metalType === 'Empty') {
                    filtered = filtered.filter(item => !item.metal_type || item.metal_type === '');
                } else {
                    filtered = filtered.filter(item => item.metal_type === metalType);
                }
            }
            
            // Filter by Design Type
            if (designType !== 'All') {
                if (designType === 'Empty') {
                    filtered = filtered.filter(item => !item.design_type || item.design_type === '');
                } else {
                    filtered = filtered.filter(item => item.design_type === designType);
                }
            }
            
            // Filter by Size Issue
            if (sizeIssue !== 'All') {
                if (sizeIssue === 'Empty') {
                    filtered = filtered.filter(item => !item.reason_size || item.reason_size === '');
                } else {
                    filtered = filtered.filter(item => item.reason_size === sizeIssue);
                }
            }
            
            // Filter by Weight Issue
            if (weightIssue !== 'All') {
                if (weightIssue === 'Empty') {
                    filtered = filtered.filter(item => !item.reason_weight || item.reason_weight === '');
                } else {
                    filtered = filtered.filter(item => item.reason_weight === weightIssue);
                }
            }
            
            // Filter by Design Out of Stock
            if (designOutofstock !== 'All') {
                if (designOutofstock === 'Empty') {
                    filtered = filtered.filter(item => !item.reason_design_outofstock || item.reason_design_outofstock === '');
                } else {
                    filtered = filtered.filter(item => item.reason_design_outofstock === designOutofstock);
                }
            }
            
            // Filter by Design New
            if (designNew !== 'All') {
                if (designNew === 'Empty') {
                    filtered = filtered.filter(item => !item.reason_design_new || item.reason_design_new === '');
                } else {
                    filtered = filtered.filter(item => item.reason_design_new === designNew);
                }
            }
            
            // Filter by Available Size (text search)
            if (availSize) {
                filtered = filtered.filter(item => 
                    item.available_size && item.available_size.toString().includes(availSize)
                );
            }
            
            // Filter by Required Size (text search)
            if (reqSize) {
                filtered = filtered.filter(item => 
                    item.required_size && item.required_size.toString().includes(reqSize)
                );
            }
            
            // Filter by Available Weight (text search)
            if (availWeight) {
                filtered = filtered.filter(item => 
                    item.available_weight && item.available_weight.toString().includes(availWeight)
                );
            }
            
            // Filter by Required Weight (text search)
            if (reqWeight) {
                filtered = filtered.filter(item => 
                    item.required_weight && item.required_weight.toString().includes(reqWeight)
                );
            }
            
            console.log('Purchase filters applied. Filtered data:', filtered.length, 'records');
            
            purchaseData = filtered;
            purchaseCurrentPage = 1; // Reset to first page
            updatePurchaseStats();
            renderPurchaseTable();
        }

        function applySalesFilters() {
            console.log('applySalesFilters called - client-side filtering');
            
            // Start with all data
            let filtered = [...allSalesData];
            
            // Apply each filter
            const purchased = document.getElementById('salesPurchasedFilter').value;
            const salesperson = document.getElementById('salesSalespersonFilter').value;
            const customerIntent = document.getElementById('salesIntentFilter').value;
            const contact = document.getElementById('salesContactFilter').value;
            const itemType = document.getElementById('salesItemTypeFilter').value;
            const metalType = document.getElementById('salesMetalTypeFilter').value;
            const designType = document.getElementById('salesDesignFilter').value;
            const priceIssue = document.getElementById('salesPriceIssueFilter').value;
            const zeroMaking = document.getElementById('salesZeroMakingFilter').value;
            const designPreference = document.getElementById('salesDesignPreferenceFilter').value;
            const customerMood = document.getElementById('salesCustomerMoodFilter').value;
            const storeImpression = document.getElementById('salesStoreImpressionFilter').value;
            
            // Filter by Purchased
            if (purchased !== 'All') {
                if (purchased === 'Empty') {
                    filtered = filtered.filter(item => !item.purchased || item.purchased === '');
                } else {
                    filtered = filtered.filter(item => item.purchased === purchased);
                }
            }
            
            // Filter by Salesperson
            if (salesperson !== 'All') {
                if (salesperson === 'Empty') {
                    filtered = filtered.filter(item => !item.salesperson_name || item.salesperson_name === '');
                } else {
                    filtered = filtered.filter(item => item.salesperson_name === salesperson);
                }
            }
            
            // Filter by Customer Intent
            if (customerIntent !== 'All') {
                if (customerIntent === 'Empty') {
                    filtered = filtered.filter(item => !item.customer_intent || item.customer_intent === '');
                } else {
                    filtered = filtered.filter(item => item.customer_intent === customerIntent);
                }
            }
            
            // Filter by Contact (text search)
            if (contact) {
                filtered = filtered.filter(item => 
                    item.contact_number && item.contact_number.toLowerCase().includes(contact.toLowerCase())
                );
            }
            
            // Filter by Item Type
            if (itemType !== 'All') {
                if (itemType === 'Empty') {
                    filtered = filtered.filter(item => !item.item_type || item.item_type === '');
                } else {
                    filtered = filtered.filter(item => item.item_type === itemType);
                }
            }
            
            // Filter by Metal Type
            if (metalType !== 'All') {
                if (metalType === 'Empty') {
                    filtered = filtered.filter(item => !item.metal_type || item.metal_type === '');
                } else {
                    filtered = filtered.filter(item => item.metal_type === metalType);
                }
            }
            
            // Filter by Design Type
            if (designType !== 'All') {
                if (designType === 'Empty') {
                    filtered = filtered.filter(item => !item.design_type || item.design_type === '');
                } else {
                    filtered = filtered.filter(item => item.design_type === designType);
                }
            }
            
            // Filter by Price Issue
            if (priceIssue !== 'All') {
                if (priceIssue === 'Empty') {
                    filtered = filtered.filter(item => !item.reason_price || item.reason_price === '');
                } else {
                    filtered = filtered.filter(item => item.reason_price === priceIssue);
                }
            }
            
            // Filter by Zero Making
            if (zeroMaking !== 'All') {
                if (zeroMaking === 'Empty') {
                    filtered = filtered.filter(item => !item.reason_zeromaking || item.reason_zeromaking === '');
                } else {
                    filtered = filtered.filter(item => item.reason_zeromaking === zeroMaking);
                }
            }
            
            // Filter by Design Preference
            if (designPreference !== 'All') {
                if (designPreference === 'Empty') {
                    filtered = filtered.filter(item => !item.design_preference || item.design_preference === '');
                } else {
                    filtered = filtered.filter(item => item.design_preference === designPreference);
                }
            }
            
            // Filter by Customer Mood
            if (customerMood !== 'All') {
                if (customerMood === 'Empty') {
                    filtered = filtered.filter(item => !item.customer_mood || item.customer_mood === '');
                } else {
                    filtered = filtered.filter(item => item.customer_mood === customerMood);
                }
            }
            
            // Filter by Store Impression
            if (storeImpression !== 'All') {
                if (storeImpression === 'Empty') {
                    filtered = filtered.filter(item => !item.store_impression || item.store_impression === '');
                } else {
                    filtered = filtered.filter(item => item.store_impression === storeImpression);
                }
            }
            
            console.log('Sales filters applied. Filtered data:', filtered.length, 'records');
            
            salesData = filtered;
            salesCurrentPage = 1; // Reset to first page
            updateSalesStats();
            renderSalesTable();
        }

        function clearFilters() {
            document.getElementById('salespersonFilter').value = 'All';
            document.getElementById('itemTypeFilter').value = 'All';
            document.getElementById('metalTypeFilter').value = 'All';
            document.getElementById('intentFilter').value = 'All';
            document.getElementById('designFilter').value = 'All';
            document.getElementById('moodFilter').value = 'All';
            document.getElementById('impressionFilter').value = 'All';
            document.getElementById('supportFilter').value = 'All';
            document.getElementById('priceIssueFilter').value = 'All';
            document.getElementById('sizeIssueFilter').value = 'All';
            
            // Reset to show all data
            feedbackData = [...allFeedbackData];
            currentPage = 1;
            updateStats();
            renderTable();
        }


        function refreshData() {
            loadFeedbackData();
        }

        async function deleteFeedback(id) {
            if (confirm('Are you sure you want to delete this feedback?')) {
                try {
                    const response = await fetch(`/api/feedback/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        // Reload the appropriate table based on active mode
                        const mode = document.querySelector('input[name="mode"]:checked').value;
                        if (mode === 'purchase') {
                            loadPurchaseData();
                        } else if (mode === 'sales') {
                            loadSalesData();
                        }
                        alert('Feedback deleted successfully');
                    } else {
                        alert('Error deleting feedback');
                    }
                } catch (error) {
                    console.error('Error deleting feedback:', error);
                    alert('Error deleting feedback');
                }
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        // Image modal functions
        function showImage(imageUrl) {
            console.log('showImage called with URL:', imageUrl);
            const modal = document.getElementById('imageModal');
            const img = document.getElementById('modalImage');
            
            if (!modal || !img) {
                console.error('Modal or image element not found!');
                return;
            }
            
            // Use the image URL as-is (should be in format: /images/{timestamped_filename})
            img.src = imageUrl;
            modal.style.display = 'block';
            
            console.log('Image src set to:', img.src);
            console.log('Modal display set to:', modal.style.display);
            
            // Handle image load errors
            img.onerror = function() {
                console.error('Failed to load image:', imageUrl);
                alert('Failed to load image. Please check if the file exists.');
            };
        }

        // Close modal when clicking X
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('imageModal');
            const closeBtn = document.querySelector('.close');
            
            if (closeBtn) {
                closeBtn.onclick = function() {
                    modal.style.display = 'none';
                }
            }
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            }
        });
    </script>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img id="modalImage" src="" alt="Customer Image">
        </div>
    </div>
</body>
</html>
